<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8"></meta>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"></meta>
    <meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name="viewport"></meta>
    <link rel="icon" sizes="16x16" href="/assets/img/favicon.ico" type="image/png"></link>
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Login</title>
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/vendors/material-icons/material-icons.css" type="text/css"></link>
    <link rel="stylesheet" href="/assets/css/style.css" type="text/css"></link>

    <style>
        .profile-page .login-center {
            padding-left: 2em !important;
            padding-right: 2em !important;
        }

        .v-center-half {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 5rem;
            margin-bottom: 5rem;
        }

        .center-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: left;
            min-height: 100vh;
        }
    </style>

<script type="text/javascript">
(function(){
window["loaderConfig"] = "/TSPD/?type=21";
})();

</script>

<script type="text/javascript" src="/TSPD/?type=18"></script>
</head>

<body class="body-bg-full profile-page" style="background: #dfe6e9">
<div class="row" id="wrapper" style="margin-top: 4rem">
    <div class="col-10 col-sm-6 col-md-4"></div>
    <div class="col-10 col-sm-6 col-md-4">
        
        <!--<div
                th:if="${session[SPRING_SECURITY_LAST_EXCEPTION] == null or session[SPRING_SECURITY_LAST_EXCEPTION].message == null or session[SPRING_SECURITY_LAST_EXCEPTION].message == 'Bad credentials'}">
            <section th:replace="~{components/success-and-error-message}"></section>
        </div>-->

        <form class="" id="loginForm" method="post" action="/login"><input type="hidden" name="_csrf" value="pdWOHFg803KLWh2aqfG8fvgS2kczY1MYMUw__i8qiqmFoKQll-S-fjpe60OmOC-qkNyIGMxw9yYHVjU1Vy4GxkxP7MyxwZUQ"/>
            <div class="card">
                <div class="card-header">
                    <!--<div class="header-text">লগইন টু বিডিআরআইএস</div>-->
                    <div class="header-text">Login To BDRIS</div>
                </div>
                <div class="card-body p-0">
                    <div class="row px-4">
                        <div class="col-md-4" style="border-right: 1px solid #dfe6e9">
                            <div class="row text-center">
                                <div class="col-md-12 v-center-half">
                                    <img alt="logo" class="logo-expand" height="130" style="max-width: initial;"
                                         src="/images/logo/logo.png"
                                         width="130"/>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div id="usernamePassDiv">
                                <div class="form-group">
                                    <label class="">ইউজারনেম</label>
                                    <input class="form-control form-control-line" id="username" name="username"
                                           placeholder="username" required/>
                                </div>
                                <div class="form-group">
                                    <label class="">পাসওয়ার্ড</label>
                                    <input class="form-control form-control-line" id="password" name="password"
                                           placeholder="password" required type="password"/>
                                </div>
                                <div class="form-group">
                                    <label class="col-form-label"></label>
                                    <div class="img-responsive">
                                        <img alt="captcha" id="captcha" src="data:image/png;base64,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"/>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-form-label" for="answer"></label>
                                    <input class="form-control" id="answer" name="answer" placeholder="Enter Captcha"
                                           required
                                           type="text" value=""/>

                                </div>
                            </div>

                            <div id="otpDiv" style="display: none">
                                <div class="form-group">
                                    <label class="">ওটিপি</label>
                                    <input class="form-control form-control-line" id="otp" name="otp"
                                           placeholder="otp"
                                           type="text"/>
                                    <span id="otpIntervalText">An otp has been sent to your mobile or email. Please wait <span
                                            id="otpInterval" style="color: red"></span> (Minutes) before requesting another otp </span>
                                    <br/>
                                    <button class="btn btn-success btn-sm sendOtpBtn" id="sendOtpAgain"
                                            style="display: none"
                                            type="button">Send OTP Again
                                    </button>
                                </div>
                            </div>

                            <div class="form-group">
                                <input class="btn btn-block btn-lg btn-color-scheme ripple sendOtpBtn" id="sendOtpBtn"
                                       type="button"
                                       value="ওটিপি পাঠান"/>
                                <input class="btn btn-block btn-lg btn-color-scheme ripple" id="loginBtn"
                                       style="display: none"
                                       type="submit"
                                       value="লগইন"/>
                                
                            </div>
                            <div class="row"></div>
                            <div class="form-group no-gutters mb-0">
                                <div class="col-md-12 d-flex">
                                    <a class="my-auto pb-2 text-right" id="to-recover"
                                       href="/user/forgot-password">পাসওয়ার্ড ভুলে গেছেন?</a>
                                </div>
                                <div class="col-md-12 d-flex">
                                    <p><a class="my-auto pb-2 text-right" href="/user/create">নতুন ব্যবহারকারীর
                                        জন্য (ওটিপি প্রাপ্তির পর)</a></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-footer text-center">
                    <p class="mb-0">Birth and Death Registration Information System</p>
                </div>
            </div>
        </form>
        <footer class="col-sm-12 text-center"></footer>
    </div>
    <div class="col-10 col-sm-6 col-md-4"></div>
</div>

<div class="modal" id="modalInstruction" role="dialog" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document" style="max-width: 1000px !important;">
        <div class="modal-content">
            <div class="modal-header">
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-md-9 col-sm-12">
                            <h5 class="modal-title">নির্দেশনা</h5>
                        </div>
                    </div>
                </div>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <div>
                    <h4 class="text-center">লগইন নির্দেশনা</h4>
                    <ul style="font-weight: bold; line-height: 2">
                        <li>লগইনের সময় সঠিক ইউজারনেইম, পাসওয়ার্ড ও ক্যাপচা প্রদান করুন।</li>
                        <li>০৩ বার ইউজারনেইম ও পাসওয়ার্ড ভুল প্রদান করা হলে উক্ত আইডি সিস্টেম হতে ৩০ মিনিটের জন্য স্থগিত
                            করা হয় এবং ৩০ মিনিট পর পুনরায় সঠিক পাসওয়ার্ড প্রদান পূর্বক লগইন করুন।
                        </li>
                        <li>লগইনের সময় ০৫ মিনিটের জন্য ওটিপির মেয়াদ থাকে। বার বার ওটিপি পুনরায় না পাঠিয়ে সর্বোচ্চ ০৫
                            মিনিট অপেক্ষা করুন। ওটিপি না আসলে ০৫ মিনিট পর পুনরায় লগইনের চেষ্টা করুন।
                        </li>
                        <li>প্রতিবার লগইনের সময় কী বোর্ডের <code>Ctrl + Shift + R</code> press করে ব্রাওজারের পূর্বের
                            ক্যাশ ক্লিয়ার করুন।
                        </li>
                        <li>যেকোনো ধরনের সমস্যার জন্য ১৬১৫২ (কল সেন্টার) তে যোগাযোগ করুন।</li>
                        <li>রেজিস্ট্রার জেনারেল কার্যালয়ের হালনাগাদ তথ্য পেতে <a href="https://orgbdr.gov.bd"
                                                                                 target="_blank">এই
                            লিংক</a> এ ভিজিট করুন।
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/js/jquery/3.7.1/jquery.min.js"></script>
<script src="/js/bootstrap/3.3.7/bootstrap.min.js"></script>
<script src="/js/jquery-validate/jquery.validate.min.js"></script>
<script>
    const otpLogin = "true";
    const context = "";
    const csrf = "pdWOHFg803KLWh2aqfG8fvgS2kczY1MYMUw__i8qiqmFoKQll-S-fjpe60OmOC-qkNyIGMxw9yYHVjU1Vy4GxkxP7MyxwZUQ";
    const otpLoginExpirationTime = "300";
    // const otpExpirationTime = /*null*/ null;
    const csrfParamName = "_csrf";

    function otpSuccess(data) {
        if (data && data['error']) {
            toastDanger('Error', data['message']);
            return;
        }
        alert(data['message']);
        $("#usernamePassDiv").hide();
        $("#sendOtpBtn").hide();
        $("#otpDiv").show();
        $("#loginBtn").show();
        $('#otpIntervalText').show();
        $("#sendOtpAgain").hide();
        countdown()
    }

    function otpError(data) {
        alert(data['responseJSON']['message']);
        location.reload();
    }

    function countdown() {
        let timer2 = (parseInt(otpLoginExpirationTime) / 60) + ":01";
        const interval = setInterval(function () {
            const timer = timer2.split(':');
            //by parsing integer, I avoid all extra string processing
            let minutes = parseInt(timer[0], 10);
            let seconds = parseInt(timer[1], 10);
            --seconds;
            minutes = (seconds < 0) ? --minutes : minutes;
            if (minutes < 0) clearInterval(interval);
            seconds = (seconds < 0) ? 59 : seconds;
            seconds = (seconds < 10) ? '0' + seconds : seconds;
            $('#otpInterval').html(minutes + ':' + seconds);
            if (minutes < 0) {
                clearInterval(interval);
            }
            //check if both minutes and seconds are 0
            if ((seconds <= 0) && (minutes <= 0)) {
                clearInterval(interval);
                $("#otpInterval").hide();
                $("#otpIntervalText").hide();
                $("#sendOtpAgain").show();
            }
            timer2 = minutes + ':' + seconds;
        }, 1000);
    }


    $(document).on("submit", "#loginForm", function (e) {
        const form = $(this);
        const otp = $('#otp').val();
        if (otpLogin && !otp) {
            $('#otp').after('<div class="invalid-feedback">Otp is Required</div>');
            return;
        }
        form.submit();

    });

    $(document).on("click", ".sendOtpBtn", function () {
        const form = $("#loginForm");
        form.validate({
            submitHandler: function (form) {
                // do other things for a valid form
                form.submit();
            }
        });
        if (!form.valid()) {
            return;
        }
        $("#sendOtpAgain").hide();
        $("#sendOtpBtn").val('অপেক্ষা করুন...').prop('disabled', true);
        const url = context + "/login/send-otp";
        const param = {};
        param['username'] = $("#username").val();
        param['password'] = $("#password").val();
        param['answer'] = $("#answer").val();
        param[csrfParamName] = csrf;
        callAjax(url, param, "POST", otpSuccess, otpError);
    });

    function callAjax(url, param, method, successCallback, errorCallback) {
        $.ajax({
            url: url,
            data: param,
            method: method,
            beforeSend: function (request) {
                request.setRequestHeader("client", "bris");
            },
            complete: function () {
                $("#sendOtpBtn").val('ওটিপি পাঠান').prop('disabled', false);
            },
            success: function (data) {
                successCallback(data);
            },
            error: function (data) {
                errorCallback(data);
                $("#sendOtpBtn").val('ওটিপি পাঠান').prop('disabled', false);
            }
        });
    }

    $(document).ready(function () {
        $("#loginForm").validate({
            focusInvalid: false,
            ignore: [],
            errorElement: 'div',
            errorClass: 'invalid-feedback',
            highlight: function (element, errorClass, validClass) {
                $(element).removeClass("is-valid").addClass("is-invalid");
            },
            unhighlight: function (element, errorClass, validClass) {
                $(element).removeClass("is-invalid").addClass("is-valid");
            },
            rules: {
                username: {required: true},
                password: {required: true},
                answer: {required: true},
                otp: {required: otpLogin}
            }
        });

        $("#modalInstruction").modal("show");
        const usernameInp = document.getElementById('username');
        const passInp = document.getElementById('password');
        usernameInp.onpaste = function (e) {
            e.preventDefault();
        }
        passInp.onpaste = function (e) {
            e.preventDefault();
        }
    });

</script>
</body>
</html>
